# TravelBuddy — Telegram‑бот для планирования поездок

TravelBuddy помогает быстро подготовиться к путешествию: выбрать страну, посмотреть свежие новости, курсы валют, погоду, достопримечательности и предстоящие праздники. Бот написан на `pyTelegramBotAPI`, хранит минимальный контекст пользователей в памяти и использует открытые API.

## Возможности
- Выбор страны назначения с сохранением валюты, столицы и координат.
- Новости за последнюю неделю по выбранной стране (WorldNews API).
- Кросс‑курс валюты пользователя к валюте страны (apilayer `currency_data`).
- Погода по столице или указанному городу (Open‑Meteo).
- Подбор достопримечательностей в радиусе 5 км через Wikipedia GeoSearch.
- Ближайшие государственные праздники (Nager.Date).
- Импорт CSV с точками маршрута и построение чернового плана по дням.
- Главное меню с быстрыми кнопками и подсказками по тексту.

## Требования
- Python 3.10+
- Аккаунт Telegram с токеном бота от [@BotFather](https://t.me/BotFather)
- Ключи для внешних API:
  - [WorldNewsAPI](https://worldnewsapi.com/) — новости
  - [apilayer currency_data](https://apilayer.com/marketplace/currency_data-api) — курсы валют

## Подготовка окружения
```bash
python3 -m venv .venv
source .venv/bin/activate       # Windows: .venv\Scripts\activate
pip install -r requirements.txt
```

Создайте файл `.env` в корне проекта и укажите токены:
```bash
BOT_TOKEN=123456:ABCDEF...             # Telegram Bot API token (обязательно)
WORLDNEWS_API_KEY=your_worldnews_key  # для новостей (обязательно)
CURRENCY_API_KEY=your_apilayer_key    # для курсов валют (обязательно)
WM_USER_AGENT=TravelBuddyBot/1.0 (+contact: you@example.com)  # опционально, но лучше указать
```

## Запуск
- Телеграм-режим: `python bot.py` (бот начнёт long polling при наличии `BOT_TOKEN`).
- Тест без Telegram: `python bot.py --country Japan` — вывод краткой сводки по стране в терминал.

## Команды бота
- `/start` — приветствие и главное меню.
- `/help` — справка по возможностям и формат CSV.
- `/set_destination <страна>` — выбрать страну (название на английском).
- `/country` — показать текущие настройки (страна, столица, валюта).
- `/news` — последние новости по стране (язык ru → en fallback).
- `/fx [base=EUR]` — курс выбранной валюты пользователя к валюте страны.
- `/weather [город]` — погода по столице или указанному городу.
- `/sights [город]` — достопримечательности рядом (Wikipedia).
- `/holidays` — ближайшие государственные праздники.
- `/csv_template` — получить CSV-шаблон для загрузки собственного маршрута.

Можно отправить CSV-файл с колонками `name, lat, lon, duration_min (priority)` — бот рассчитает порядок посещений и сгруппирует их по дням.

## Полезные материалы
- `schema.png` / `schema.drawio` — схема взаимодействия бота с внешними сервисами.
- Каталог `data/` — место для ваших CSV-файлов с маршрутами (не обязателен).

## Ограничения
- Контекст (выбранная страна, валюта) хранится только в оперативной памяти и теряется при перезапуске.
- Для работы требуется доступ к интернету и активные API-ключи.
- Логи по умолчанию выводятся в stdout; при необходимости настройте `logging` в `bot.py`.
